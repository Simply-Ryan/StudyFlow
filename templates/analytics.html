{% extends "base.html" %}

{% block title %}Study Analytics - Study Sessions{% endblock %}

{% block content %}
<div class="analytics-container">
    <div class="analytics-header">
        <h1><i class="fas fa-chart-line"></i> Study Analytics</h1>
        <p>Track your study progress and session statistics</p>
    </div>

    <!-- Summary Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3>{{ total_hours }}</h3>
                <p>Total Study Hours</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-info">
                <h3>{{ total_sessions }}</h3>
                <p>Sessions Attended</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <i class="fas fa-book"></i>
            </div>
            <div class="stat-info">
                <h3>{{ favorite_subject }}</h3>
                <p>Most Studied Subject</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <i class="fas fa-fire"></i>
            </div>
            <div class="stat-info">
                <h3>{{ current_streak }} days</h3>
                <p>Current Streak</p>
            </div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="charts-row">
        <div class="chart-container">
            <h2><i class="fas fa-calendar-alt"></i> Study Sessions Over Time</h2>
            <canvas id="sessionsOverTimeChart"></canvas>
        </div>

        <div class="chart-container">
            <h2><i class="fas fa-book-open"></i> Study by Subject</h2>
            <canvas id="subjectBreakdownChart"></canvas>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="charts-row">
        <div class="chart-container">
            <h2><i class="fas fa-clock"></i> Study Hours by Day of Week</h2>
            <canvas id="dayOfWeekChart"></canvas>
        </div>

        <div class="chart-container">
            <h2><i class="fas fa-chart-bar"></i> Monthly Progress</h2>
            <canvas id="monthlyProgressChart"></canvas>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity">
        <h2><i class="fas fa-history"></i> Recent Study Sessions</h2>
        <div class="activity-list">
            {% for session in recent_sessions %}
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-{% if session.type == 'exam' %}graduation-cap{% elif session.type == 'project' %}laptop-code{% elif session.type == 'homework' %}pencil-alt{% else %}book{% endif %}"></i>
                    </div>
                    <div class="activity-details">
                        <h4>{{ session.title }}</h4>
                        <p>
                            {{ session.subject }} • {{ session.date }}
                            {% if session.duration %}
                                • {{ session.duration }} hours
                            {% endif %}
                        </p>
                    </div>
                    <a href="{{ url_for('detail', session_id=session.id) }}" class="activity-link">
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Chart.js default configuration
    Chart.defaults.font.family = 'Inter, sans-serif';
    Chart.defaults.color = '#4a5568';

    // Sessions Over Time Chart
    const sessionsCtx = document.getElementById('sessionsOverTimeChart');
    new Chart(sessionsCtx, {
        type: 'line',
        data: {
            labels: {{ sessions_dates | tojson }},
            datasets: [{
                label: 'Study Sessions',
                data: {{ sessions_counts | tojson }},
                borderColor: 'rgba(102, 126, 234, 1)',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        }
    });

    // Subject Breakdown Chart
    const subjectCtx = document.getElementById('subjectBreakdownChart');
    new Chart(subjectCtx, {
        type: 'doughnut',
        data: {
            labels: {{ subject_labels | tojson }},
            datasets: [{
                data: {{ subject_counts | tojson }},
                backgroundColor: [
                    'rgba(102, 126, 234, 0.8)',
                    'rgba(240, 147, 251, 0.8)',
                    'rgba(79, 172, 254, 0.8)',
                    'rgba(67, 233, 123, 0.8)',
                    'rgba(251, 176, 59, 0.8)',
                    'rgba(245, 101, 101, 0.8)'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Day of Week Chart
    const dayCtx = document.getElementById('dayOfWeekChart');
    new Chart(dayCtx, {
        type: 'bar',
        data: {
            labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
            datasets: [{
                label: 'Hours Studied',
                data: {{ day_of_week_hours | tojson }},
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderColor: 'rgba(102, 126, 234, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Monthly Progress Chart
    const monthlyCtx = document.getElementById('monthlyProgressChart');
    new Chart(monthlyCtx, {
        type: 'bar',
        data: {
            labels: {{ monthly_labels | tojson }},
            datasets: [{
                label: 'Sessions',
                data: {{ monthly_sessions | tojson }},
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderColor: 'rgba(102, 126, 234, 1)',
                borderWidth: 2,
                yAxisID: 'y'
            }, {
                label: 'Hours',
                data: {{ monthly_hours | tojson }},
                backgroundColor: 'rgba(118, 75, 162, 0.8)',
                borderColor: 'rgba(118, 75, 162, 1)',
                borderWidth: 2,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    }
                }
            }
        }
    });
</script>

<style>
.analytics-container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 2rem;
}

.analytics-header {
    text-align: center;
    margin-bottom: 3rem;
}

.analytics-header h1 {
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.analytics-header p {
    color: #718096;
    font-size: 1.1rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: transform 0.3s, box-shadow 0.3s;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.stat-info h3 {
    margin: 0;
    color: #2d3748;
    font-size: 2rem;
    font-weight: 700;
}

.stat-info p {
    margin: 0.25rem 0 0 0;
    color: #718096;
    font-size: 0.95rem;
}

.charts-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.chart-container {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.chart-container h2 {
    color: #2d3748;
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.chart-container canvas {
    height: 300px !important;
}

.recent-activity {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 2rem;
}

.recent-activity h2 {
    color: #2d3748;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    transition: all 0.3s;
}

.activity-item:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.activity-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.activity-details {
    flex: 1;
}

.activity-details h4 {
    margin: 0 0 0.25rem 0;
    color: #2d3748;
}

.activity-details p {
    margin: 0;
    color: #718096;
    font-size: 0.9rem;
}

.activity-link {
    color: #667eea;
    font-size: 1.2rem;
    transition: transform 0.3s;
}

.activity-link:hover {
    transform: translateX(5px);
}

@media (max-width: 768px) {
    .charts-row {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
